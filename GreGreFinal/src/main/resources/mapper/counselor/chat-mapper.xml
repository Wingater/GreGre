<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="chat">
	
<select id="findChatIdByMemberId" resultType="String">
	select 
		    chat_id
		from 
		    chat_view
		where
		    cr_enabled = 'Y'
		  and 
		    cm_enabled = 'Y'
		  and
		    member_id = #{memberId}

</select>

<select id="selectOneChatId" resultType="string">
	select 
		chat_id
	from
		chat_view
	where
		chat_id = #{chatId}
</select>

<insert id="insertChatRoom">
		insert into
		    chat_room 
		        (id, chat_id)
		values(
		    seq_chat.nextval, 
		    #{chatId}
		)
		<selectKey order="AFTER" keyProperty="id" resultType="_long">
			select 
				seq_chat.currval
			from
				dual
		</selectKey>
	</insert>
	
	<insert id="insertChatMember">
		insert into
		    chat_member
		        (id, chat_room_id, member_id)
		
		values(
		    seq_chat.nextval,
		    #{chatRoom.id},
		    #{memberId}
		)
	</insert>

	
</mapper>